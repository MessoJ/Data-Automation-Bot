{% extends "base.html" %}

{% block title %}E-commerce Command Center - Premium Dashboard{% endblock %}

{% block content %}
<!-- Premium E-commerce Dashboard -->
<div class="premium-dashboard">
    <!-- Hero Header with Glassmorphism -->
    <header class="dashboard-hero">
        <div class="hero-background">
            <div class="floating-shapes">
                <div class="shape shape-1"></div>
                <div class="shape shape-2"></div>
                <div class="shape shape-3"></div>
                <div class="shape shape-4"></div>
            </div>
        </div>
        
        <div class="hero-content">
            <div class="hero-main">
                <div class="user-greeting">
                    <div class="avatar-container">
                        <img src="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='%2316a085'><path d='M12 2C13.1 2 14 2.9 14 4C14 5.1 13.1 6 12 6C10.9 6 10 5.1 10 4C10 2.9 10.9 2 12 2ZM21 9V7L15 7C14.5 7 14 7.4 14 8V10C14 10.6 14.4 11 15 11H16V13H8V11H9C9.6 11 10 10.6 10 10V8C10 7.4 9.5 7 9 7L3 7V9L8 9V19C8 20.1 8.9 21 10 21H14C15.1 21 16 20.1 16 19V9L21 9Z'/></svg>" alt="User Avatar" class="user-avatar">
                        <div class="online-indicator"></div>
                    </div>
                    <div class="greeting-text">
                        <h1 class="greeting-title">Welcome back, <span class="user-name">Alex</span>! 👋</h1>
                        <p class="greeting-subtitle">Your e-commerce empire is thriving today</p>
                    </div>
                </div>
                
                <div class="hero-stats">
                    <div class="quick-stat">
                        <div class="stat-icon trend-up">📈</div>
                        <div class="stat-content">
                            <span class="stat-value">+24%</span>
                            <span class="stat-label">Revenue Growth</span>
                        </div>
                    </div>
                    <div class="quick-stat">
                        <div class="stat-icon sync-icon">🔄</div>
                        <div class="stat-content">
                            <span class="stat-value" id="syncStatus">All Synced</span>
                            <span class="stat-label">Platform Status</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="hero-actions">
                <button class="premium-btn primary" onclick="runQuickSync()" id="masterSyncBtn">
                    <span class="btn-icon">⚡</span>
                    <span class="btn-text">Quick Sync</span>
                    <div class="btn-glow"></div>
                </button>
                <button class="premium-btn secondary" onclick="openAnalytics()">
                    <span class="btn-icon">📊</span>
                    <span class="btn-text">Analytics</span>
                </button>
            </div>
        </div>
    </header>

    <!-- Live Performance Dashboard -->
    <section class="performance-dashboard">
        <div class="section-header">
            <h2 class="section-title">
                <span class="title-icon">🎯</span>
                Live Performance
            </h2>
            <div class="header-actions">
                <div class="time-selector">
                    <button class="time-btn active" data-period="today">Today</button>
                    <button class="time-btn" data-period="week">7 Days</button>
                    <button class="time-btn" data-period="month">30 Days</button>
                </div>
                <button class="refresh-btn" onclick="refreshDashboard()" id="refreshBtn">
                    <svg class="refresh-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                        <path d="M23 4v6h-6M1 20v-6h6M20.49 9A9 9 0 0 0 5.64 5.64L1 10m22 4l-4.64 4.36A9 9 0 0 1 3.51 15"/>
                    </svg>
                </button>
            </div>
        </div>

        <!-- Premium KPI Cards -->
        <div class="kpi-grid">
            <!-- Revenue Card -->
            <div class="kpi-card revenue-card" id="revenueKPI">
                <div class="card-background">
                    <div class="bg-pattern revenue-pattern"></div>
                </div>
                <div class="card-content">
                    <div class="kpi-header">
                        <div class="kpi-icon revenue-icon">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
                                <circle cx="12" cy="12" r="10"/>
                                <path d="M12 6v6l4 2"/>
                            </svg>
                        </div>
                        <div class="kpi-trend positive" id="revenueTrend">
                            <span class="trend-icon">↗</span>
                            <span class="trend-value">+18.2%</span>
                        </div>
                    </div>
                    <div class="kpi-main">
                        <h3 class="kpi-value" id="totalRevenue">$84,392</h3>
                        <p class="kpi-label">Total Revenue</p>
                        <div class="kpi-detail">
                            <span class="detail-text">$2,813 daily average</span>
                        </div>
                    </div>
                </div>
                <div class="card-sparkline">
                    <canvas id="revenueSparkline" width="120" height="40"></canvas>
                </div>
            </div>

            <!-- Orders Card -->
            <div class="kpi-card orders-card" id="ordersKPI">
                <div class="card-background">
                    <div class="bg-pattern orders-pattern"></div>
                </div>
                <div class="card-content">
                    <div class="kpi-header">
                        <div class="kpi-icon orders-icon">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
                                <path d="M16 11V7a4 4 0 0 0-8 0v4H5v8h14v-8h-3z"/>
                            </svg>
                        </div>
                        <div class="kpi-trend positive" id="ordersTrend">
                            <span class="trend-icon">↗</span>
                            <span class="trend-value">+12.7%</span>
                        </div>
                    </div>
                    <div class="kpi-main">
                        <h3 class="kpi-value" id="totalOrders">1,247</h3>
                        <p class="kpi-label">Orders Today</p>
                        <div class="kpi-detail">
                            <span class="detail-text">156 pending fulfillment</span>
                        </div>
                    </div>
                </div>
                <div class="card-sparkline">
                    <canvas id="ordersSparkline" width="120" height="40"></canvas>
                </div>
            </div>

            <!-- Inventory Health Card -->
            <div class="kpi-card inventory-card" id="inventoryKPI">
                <div class="card-background">
                    <div class="bg-pattern inventory-pattern"></div>
                </div>
                <div class="card-content">
                    <div class="kpi-header">
                        <div class="kpi-icon inventory-icon">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
                                <path d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z"/>
                                <polyline points="3.27,6.96 12,12.01 20.73,6.96"/>
                            </svg>
                        </div>
                        <div class="health-indicator excellent" id="inventoryHealth">
                            <span class="health-dot"></span>
                            <span class="health-text">Excellent</span>
                        </div>
                    </div>
                    <div class="kpi-main">
                        <h3 class="kpi-value" id="inventoryItems">3,842</h3>
                        <p class="kpi-label">Active Products</p>
                        <div class="kpi-detail">
                            <span class="detail-text">2 alerts need attention</span>
                        </div>
                    </div>
                </div>
                <div class="inventory-gauge">
                    <div class="gauge-chart" id="inventoryGauge"></div>
                </div>
            </div>

            <!-- Platform Status Card -->
            <div class="kpi-card platforms-card" id="platformsKPI">
                <div class="card-background">
                    <div class="bg-pattern platforms-pattern"></div>
                </div>
                <div class="card-content">
                    <div class="kpi-header">
                        <div class="kpi-icon platforms-icon">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
                                <path d="M12 2l10 7-10 7-10-7z"/>
                                <path d="M12 23l8-6"/>
                                <path d="M12 23l-8-6"/>
                            </svg>
                        </div>
                        <div class="connection-status all-online">
                            <span class="status-text">All Online</span>
                        </div>
                    </div>
                    <div class="kpi-main">
                        <h3 class="kpi-value" id="connectedPlatforms">5</h3>
                        <p class="kpi-label">Connected Platforms</p>
                        <div class="platform-icons">
                            <div class="platform-dot shopify active" title="Shopify"></div>
                            <div class="platform-dot amazon active" title="Amazon"></div>
                            <div class="platform-dot ebay active" title="eBay"></div>
                            <div class="platform-dot woo active" title="WooCommerce"></div>
                            <div class="platform-dot etsy active" title="Etsy"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Premium Chart Section -->
    <section class="charts-section">
        <div class="charts-grid">
            <!-- Main Revenue Chart -->
            <div class="chart-card main-chart">
                <div class="chart-header">
                    <div class="chart-title">
                        <h3>Revenue Analytics</h3>
                        <p>Real-time performance across all channels</p>
                    </div>
                    <div class="chart-controls">
                        <div class="chart-tabs">
                            <button class="tab-btn active" data-chart="revenue">Revenue</button>
                            <button class="tab-btn" data-chart="orders">Orders</button>
                            <button class="tab-btn" data-chart="conversion">Conversion</button>
                        </div>
                        <button class="fullscreen-btn" onclick="toggleFullscreen()">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
                                <path d="M8 3H5a2 2 0 0 0-2 2v3m18 0V5a2 2 0 0 0-2-2h-3m0 18h3a2 2 0 0 0 2-2v-3M3 16v3a2 2 0 0 0 2 2h3"/>
                            </svg>
                        </button>
                    </div>
                </div>
                <div class="chart-container">
                    <canvas id="mainChart" width="600" height="300"></canvas>
                </div>
                <div class="chart-insights">
                    <div class="insight">
                        <span class="insight-icon">🚀</span>
                        <span class="insight-text">Peak sales: $3,247 at 3:00 PM</span>
                    </div>
                    <div class="insight">
                        <span class="insight-icon">📈</span>
                        <span class="insight-text">Trending up 24% vs yesterday</span>
                    </div>
                </div>
            </div>

            <!-- Platform Performance -->
            <div class="chart-card platform-chart">
                <div class="chart-header">
                    <div class="chart-title">
                        <h3>Platform Performance</h3>
                        <p>Revenue distribution by channel</p>
                    </div>
                </div>
                <div class="platform-stats">
                    <div class="platform-stat shopify-stat">
                        <div class="stat-header">
                            <div class="platform-logo shopify-logo">🛍️</div>
                            <div class="stat-trend positive">+15%</div>
                        </div>
                        <div class="stat-main">
                            <h4>Shopify</h4>
                            <p class="stat-value">$38,247</p>
                            <div class="stat-bar">
                                <div class="bar-fill shopify-fill" style="width: 65%"></div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="platform-stat amazon-stat">
                        <div class="stat-header">
                            <div class="platform-logo amazon-logo">📦</div>
                            <div class="stat-trend positive">+8%</div>
                        </div>
                        <div class="stat-main">
                            <h4>Amazon</h4>
                            <p class="stat-value">$28,193</p>
                            <div class="stat-bar">
                                <div class="bar-fill amazon-fill" style="width: 48%"></div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="platform-stat ebay-stat">
                        <div class="stat-header">
                            <div class="platform-logo ebay-logo">🏪</div>
                            <div class="stat-trend neutral">-2%</div>
                        </div>
                        <div class="stat-main">
                            <h4>eBay</h4>
                            <p class="stat-value">$12,847</p>
                            <div class="stat-bar">
                                <div class="bar-fill ebay-fill" style="width: 22%"></div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="platform-stat woo-stat">
                        <div class="stat-header">
                            <div class="platform-logo woo-logo">🌐</div>
                            <div class="stat-trend positive">+32%</div>
                        </div>
                        <div class="stat-main">
                            <h4>WooCommerce</h4>
                            <p class="stat-value">$5,105</p>
                            <div class="stat-bar">
                                <div class="bar-fill woo-fill" style="width: 9%"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Smart Actions Hub -->
    <section class="actions-hub">
        <div class="section-header">
            <h2 class="section-title">
                <span class="title-icon">⚡</span>
                Smart Actions
            </h2>
            <p class="section-subtitle">Automate your workflow with intelligent actions</p>
        </div>

        <div class="actions-grid">
            <!-- Priority Actions -->
            <div class="action-group priority-actions">
                <h3 class="group-title">Priority Actions</h3>
                <div class="action-items">
                    <div class="action-item critical" onclick="fixInventoryIssues()">
                        <div class="action-icon critical-icon">🚨</div>
                        <div class="action-content">
                            <h4>Fix Inventory Issues</h4>
                            <p>2 critical discrepancies found</p>
                            <div class="action-badge urgent">Urgent</div>
                        </div>
                        <div class="action-arrow">→</div>
                    </div>

                    <div class="action-item important" onclick="updatePricing()">
                        <div class="action-icon price-icon">💰</div>
                        <div class="action-content">
                            <h4>Update Pricing</h4>
                            <p>Competitor analysis ready</p>
                            <div class="action-badge high">High Priority</div>
                        </div>
                        <div class="action-arrow">→</div>
                    </div>
                </div>
            </div>

            <!-- Quick Actions -->
            <div class="action-group quick-actions">
                <h3 class="group-title">Quick Actions</h3>
                <div class="action-items">
                    <div class="action-item" onclick="syncAllPlatforms()">
                        <div class="action-icon sync-icon">🔄</div>
                        <div class="action-content">
                            <h4>Sync All Platforms</h4>
                            <p>Last sync: 3 minutes ago</p>
                        </div>
                        <div class="action-arrow">→</div>
                    </div>

                    <div class="action-item" onclick="generateReport()">
                        <div class="action-icon report-icon">📊</div>
                        <div class="action-content">
                            <h4>Generate Report</h4>
                            <p>Export performance data</p>
                        </div>
                        <div class="action-arrow">→</div>
                    </div>

                    <div class="action-item" onclick="addNewProduct()">
                        <div class="action-icon add-icon">➕</div>
                        <div class="action-content">
                            <h4>Add New Product</h4>
                            <p>Cross-platform listing</p>
                        </div>
                        <div class="action-arrow">→</div>
                    </div>

                    <div class="action-item" onclick="viewAnalytics()">
                        <div class="action-icon analytics-icon">📈</div>
                        <div class="action-content">
                            <h4>View Analytics</h4>
                            <p>Detailed insights</p>
                        </div>
                        <div class="action-arrow">→</div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Real-time Activity Feed -->
    <section class="activity-section">
        <div class="section-header">
            <h2 class="section-title">
                <span class="title-icon">📡</span>
                Live Activity
            </h2>
            <div class="activity-controls">
                <button class="filter-btn active" data-filter="all">All</button>
                <button class="filter-btn" data-filter="sync">Sync</button>
                <button class="filter-btn" data-filter="sales">Sales</button>
                <button class="filter-btn" data-filter="alerts">Alerts</button>
            </div>
        </div>

        <div class="activity-feed" id="activityFeed">
            <div class="activity-item success" data-type="sync">
                <div class="activity-icon success-icon">✅</div>
                <div class="activity-content">
                    <div class="activity-main">
                        <h4>Shopify sync completed successfully</h4>
                        <p>1,247 products updated, 3 new orders imported</p>
                    </div>
                    <div class="activity-meta">
                        <span class="activity-time">2 minutes ago</span>
                        <span class="activity-platform">Shopify</span>
                    </div>
                </div>
                <button class="activity-action" onclick="viewSyncDetails()">View Details</button>
            </div>

            <div class="activity-item sale" data-type="sales">
                <div class="activity-icon sale-icon">💳</div>
                <div class="activity-content">
                    <div class="activity-main">
                        <h4>New order: $247.99</h4>
                        <p>Premium Wireless Headphones - Customer: John D.</p>
                    </div>
                    <div class="activity-meta">
                        <span class="activity-time">4 minutes ago</span>
                        <span class="activity-platform">Amazon</span>
                    </div>
                </div>
                <button class="activity-action" onclick="viewOrder()">View Order</button>
            </div>

            <div class="activity-item warning" data-type="alerts">
                <div class="activity-icon warning-icon">⚠️</div>
                <div class="activity-content">
                    <div class="activity-main">
                        <h4>Low stock alert</h4>
                        <p>iPhone Case - Silver (SKU: IPH-CASE-001) - Only 5 units left</p>
                    </div>
                    <div class="activity-meta">
                        <span class="activity-time">8 minutes ago</span>
                        <span class="activity-platform">Multi-platform</span>
                    </div>
                </div>
                <button class="activity-action urgent" onclick="restockItem()">Restock</button>
            </div>

            <div class="activity-item info" data-type="sync">
                <div class="activity-icon info-icon">ℹ️</div>
                <div class="activity-content">
                    <div class="activity-main">
                        <h4>eBay listing optimization suggested</h4>
                        <p>15 products could benefit from better keywords</p>
                    </div>
                    <div class="activity-meta">
                        <span class="activity-time">12 minutes ago</span>
                        <span class="activity-platform">eBay</span>
                    </div>
                </div>
                <button class="activity-action" onclick="optimizeListings()">Optimize</button>
            </div>
        </div>

        <button class="load-more-btn" onclick="loadMoreActivity()">
            <span class="btn-text">Load More Activity</span>
            <span class="btn-icon">↓</span>
        </button>
    </section>
</div>

<!-- Premium Loading Overlay -->
<div class="premium-loading" id="premiumLoading">
    <div class="loading-container">
        <div class="loading-spinner">
            <div class="spinner-ring"></div>
            <div class="spinner-ring"></div>
            <div class="spinner-ring"></div>
        </div>
        <h3 class="loading-title" id="loadingTitle">Syncing your data...</h3>
        <p class="loading-subtitle" id="loadingSubtitle">Please wait while we update your platforms</p>
        <div class="loading-progress">
            <div class="progress-bar" id="loadingProgressBar"></div>
        </div>
        <div class="loading-steps" id="loadingSteps">
            <div class="step completed">✓ Connected to Shopify</div>
            <div class="step active">🔄 Syncing inventory...</div>
            <div class="step">⏳ Updating prices</div>
        </div>
    </div>
</div>

<!-- Premium Toast System -->
<div class="toast-system" id="toastSystem"></div>

<!-- Success Modal -->
<div class="premium-modal" id="successModal">
    <div class="modal-overlay" onclick="closeModal('successModal')"></div>
    <div class="modal-container">
        <div class="modal-content">
            <div class="success-animation">
                <div class="success-icon">🎉</div>
                <div class="success-confetti">
                    <div class="confetti"></div>
                    <div class="confetti"></div>
                    <div class="confetti"></div>
                    <div class="confetti"></div>
                    <div class="confetti"></div>
                </div>
            </div>
            <h2>Sync Completed Successfully!</h2>
            <p>All your platforms are now perfectly synchronized.</p>
            
            <div class="sync-summary">
                <div class="summary-item">
                    <span class="summary-label">Products Updated:</span>
                    <span class="summary-value">1,247</span>
                </div>
                <div class="summary-item">
                    <span class="summary-label">Discrepancies Fixed:</span>
                    <span class="summary-value">8</span>
                </div>
                <div class="summary-item">
                    <span class="summary-label">Time Saved:</span>
                    <span class="summary-value">3.5 hours</span>
                </div>
            </div>
            
            <div class="modal-actions">
                <button class="premium-btn primary" onclick="closeModal('successModal')">Awesome!</button>
                <button class="premium-btn secondary" onclick="viewSyncReport()">View Report</button>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
// Premium Dashboard JavaScript with Advanced Features
let dashboardCharts = {};
let realtimeInterval;
let syncInProgress = false;

// Initialize Premium Dashboard
document.addEventListener('DOMContentLoaded', function() {
    initializeDashboard();
    setupEventListeners();
    startRealtimeUpdates();
    initializeCharts();
    loadDashboardData();
    
    // Add premium entrance animations
    animateEntrance();
});

function initializeDashboard() {
    console.log('🚀 Initializing Premium E-commerce Dashboard...');
    
    // Set current time
    updateTimeDisplay();
    
    // Initialize floating shapes animation
    initializeFloatingShapes();
    
    // Setup intersection observer for scroll animations
    setupScrollAnimations();
}

function animateEntrance() {
    const elements = document.querySelectorAll('.kpi-card, .chart-card, .action-group');
    elements.forEach((el, index) => {
        el.style.opacity = '0';
        el.style.transform = 'translateY(30px)';
        
        setTimeout(() => {
            el.style.transition = 'all 0.6s cubic-bezier(0.4, 0, 0.2, 1)';
            el.style.opacity = '1';
            el.style.transform = 'translateY(0)';
        }, index * 100);
    });
}

function setupEventListeners() {
    // Time selector buttons
    document.querySelectorAll('.time-btn').forEach(btn => {
        btn.addEventListener('click', function() {
            document.querySelectorAll('.time-btn').forEach(b => b.classList.remove('active'));
            this.classList.add('active');
            updateChartsForPeriod(this.dataset.period);
        });
    });

    // Chart tabs
    document.querySelectorAll('.tab-btn').forEach(btn => {
        btn.addEventListener('click', function() {
            document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
            this.classList.add('active');
            switchChart(this.dataset.chart);
        });
    });

    // Activity filters
    document.querySelectorAll('.filter-btn').forEach(btn => {
        btn.addEventListener('click', function() {
            document.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active'));
            this.classList.add('active');
            filterActivity(this.dataset.filter);
        });
    });
}

function initializeCharts() {
    // Main revenue chart
    const mainCtx = document.getElementById('mainChart').getContext('2d');
    
    dashboardCharts.main = new Chart(mainCtx, {
        type: 'line',
        data: {
            labels: generateTimeLabels(30),
            datasets: [{
                label: 'Revenue',
                data: generateRevenueData(30),
                borderColor: 'rgba(34, 197, 94, 1)',
                backgroundColor: 'rgba(34, 197, 94, 0.1)',
                borderWidth: 3,
                fill: true,
                tension: 0.4,
                pointBackgroundColor: 'rgba(34, 197, 94, 1)',
                pointBorderColor: '#ffffff',
                pointBorderWidth: 2,
                pointRadius: 6,
                pointHoverRadius: 8
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                legend: {
                    display: false
                },
                tooltip: {
                    backgroundColor: 'rgba(0, 0, 0, 0.9)',
                    titleColor: '#ffffff',
                    bodyColor: '#ffffff',
                    borderColor: 'rgba(34, 197, 94, 1)',
                    borderWidth: 1,
                    cornerRadius: 12,
                    displayColors: false,
                    callbacks: {
                        label: function(context) {
                            return `Revenue: $${context.parsed.y.toLocaleString()}`;
                        }
                    }
                }
            },
            scales: {
                x: {
                    display: true,
                    grid: {
                        display: false
                    },
                    ticks: {
                        color: 'rgba(148, 163, 184, 0.8)',
                        font: {
                            size: 12,
                            weight: '500'
                        }
                    }
                },
                y: {
                    display: true,
                    grid: {
                        color: 'rgba(148, 163, 184, 0.1)',
                        drawBorder: false
                    },
                    ticks: {
                        color: 'rgba(148, 163, 184, 0.8)',
                        font: {
                            size: 12,
                            weight: '500'
                        },
                        callback: function(value) {
                            return '$' + (value / 1000) + 'k';
                        }
                    }
                }
            },
            interaction: {
                intersect: false,
                mode: 'index'
            }
        }
    });

    // Initialize sparklines
    initializeSparklines();
}

function initializeSparklines() {
    const sparklineConfig = {
        type: 'line',
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                legend: { display: false },
                tooltip: { enabled: false }
            },
            scales: {
                x: { display: false },
                y: { display: false }
            },
            elements: {
                point: { radius: 0 }
            }
        }
    };

    // Revenue sparkline
    const revenueSparkCtx = document.getElementById('revenueSparkline').getContext('2d');
    new Chart(revenueSparkCtx, {
        ...sparklineConfig,
        data: {
            labels: generateTimeLabels(7),
            datasets: [{
                data: generateSparklineData(7, 2000, 4000),
                borderColor: 'rgba(34, 197, 94, 1)',
                backgroundColor: 'rgba(34, 197, 94, 0.2)',
                borderWidth: 2,
                fill: true,
                tension: 0.4
            }]
        }
    });

    // Orders sparkline
    const ordersSparkCtx = document.getElementById('ordersSparkline').getContext('2d');
    new Chart(ordersSparkCtx, {
        ...sparklineConfig,
        data: {
            labels: generateTimeLabels(7),
            datasets: [{
                data: generateSparklineData(7, 100, 200),
                borderColor: 'rgba(59, 130, 246, 1)',
                backgroundColor: 'rgba(59, 130, 246, 0.2)',
                borderWidth: 2,
                fill: true,
                tension: 0.4
            }]
        }
    });
}

function generateTimeLabels(count) {
    const labels = [];
    for (let i = count - 1; i >= 0; i--) {
        const date = new Date();
        date.setDate(date.getDate() - i);
        labels.push(date.getDate().toString());
    }
    return labels;
}

function generateRevenueData(count) {
    const data = [];
    for (let i = 0; i < count; i++) {
        data.push(Math.floor(Math.random() * 3000) + 1500);
    }
    return data;
}

function generateSparklineData(count, min, max) {
    const data = [];
    for (let i = 0; i < count; i++) {
        data.push(Math.floor(Math.random() * (max - min)) + min);
    }
    return data;
}

function runQuickSync() {
    if (syncInProgress) return;
    
    syncInProgress = true;
    showPremiumLoading('Syncing all platforms...', 'Connecting to your e-commerce channels');
    
    const steps = [
        { text: '✓ Connected to Shopify', delay: 1000 },
        { text: '✓ Connected to Amazon', delay: 2000 },
        { text: '✓ Connected to eBay', delay: 3000 },
        { text: '🔄 Syncing inventory...', delay: 4000 },
        { text: '🔄 Updating prices...', delay: 5500 },
        { text: '✓ Sync completed successfully!', delay: 7000 }
    ];

    updateLoadingSteps(steps);
    
    // Animate sync button
    const syncBtn = document.getElementById('masterSyncBtn');
    syncBtn.classList.add('syncing');
    
    setTimeout(() => {
        hidePremiumLoading();
        showSuccessModal();
        updateDashboardAfterSync();
        syncBtn.classList.remove('syncing');
        syncInProgress = false;
        
        showPremiumToast('🎉 Sync completed successfully! All platforms are now up to date.', 'success');
    }, 8000);
}

function showPremiumLoading(title, subtitle) {
    const loading = document.getElementById('premiumLoading');
    document.getElementById('loadingTitle').textContent = title;
    document.getElementById('loadingSubtitle').textContent = subtitle;
    loading.classList.add('show');
    
    // Animate progress bar
    const progressBar = document.getElementById('loadingProgressBar');
    let progress = 0;
    const progressInterval = setInterval(() => {
        progress += Math.random() * 10;
        if (progress > 95) {
            progress = 95;
            clearInterval(progressInterval);
        }
        progressBar.style.width = progress + '%';
    }, 200);
}

function hidePremiumLoading() {
    const loading = document.getElementById('premiumLoading');
    const progressBar = document.getElementById('loadingProgressBar');
    progressBar.style.width = '100%';
    
    setTimeout(() => {
        loading.classList.remove('show');
        progressBar.style.width = '0%';
    }, 500);
}

function updateLoadingSteps(steps) {
    const stepsContainer = document.getElementById('loadingSteps');
    
    steps.forEach((step, index) => {
        setTimeout(() => {
            stepsContainer.innerHTML = '';
            steps.slice(0, index + 1).forEach((s, i) => {
                const stepEl = document.createElement('div');
                stepEl.className = i === index ? 'step active' : 'step completed';
                stepEl.textContent = s.text;
                stepsContainer.appendChild(stepEl);
            });
        }, step.delay);
    });
}

function showSuccessModal() {
    const modal = document.getElementById('successModal');
    modal.classList.add('show');
    
    // Auto hide after 8 seconds
    setTimeout(() => {
        closeModal('successModal');
    }, 8000);
}

function closeModal(modalId) {
    const modal = document.getElementById(modalId);
    modal.classList.remove('show');
}

function showPremiumToast(message, type = 'info', duration = 5000) {
    const toastSystem = document.getElementById('toastSystem');
    const toast = document.createElement('div');
    toast.className = `premium-toast ${type}`;
    
    const icons = {
        success: '✅',
        error: '❌',
        warning: '⚠️',
        info: 'ℹ️'
    };
    
    toast.innerHTML = `
        <div class="toast-content">
            <div class="toast-icon">${icons[type]}</div>
            <div class="toast-message">${message}</div>
            <button class="toast-close" onclick="this.parentElement.parentElement.remove()">×</button>
        </div>
    `;
    
    toastSystem.appendChild(toast);
    
    setTimeout(() => toast.classList.add('show'), 100);
    
    setTimeout(() => {
        toast.classList.remove('show');
        setTimeout(() => toast.remove(), 300);
    }, duration);
}

function startRealtimeUpdates() {
    realtimeInterval = setInterval(() => {
        updateRealtimeData();
        updateActivityFeed();
    }, 30000); // Update every 30 seconds
}

function updateRealtimeData() {
    // Simulate real-time updates
    const revenue = document.getElementById('totalRevenue');
    const orders = document.getElementById('totalOrders');
    const currentRevenue = parseInt(revenue.textContent.replace(/[$,]/g, ''));
    const currentOrders = parseInt(orders.textContent.replace(/,/g, ''));
    
    // Small random increases
    const newRevenue = currentRevenue + Math.floor(Math.random() * 500);
    const newOrders = currentOrders + Math.floor(Math.random() * 5);
    
    // Animate number changes
    animateValue(revenue, currentRevenue, newRevenue, 2000, '$');
    animateValue(orders, currentOrders, newOrders, 2000);
}

function animateValue(element, start, end, duration, prefix = '') {
    const startTime = Date.now();
    const range = end - start;
    
    function update() {
        const elapsed = Date.now() - startTime;
        const progress = Math.min(elapsed / duration, 1);
        const current = Math.floor(start + range * progress);
        element.textContent = prefix + current.toLocaleString();
        
        if (progress < 1) {
            requestAnimationFrame(update);
        }
    }
    
    requestAnimationFrame(update);
}

function updateActivityFeed() {
    const activities = [
        {
            type: 'sale',
            icon: '💳',
            title: 'New order: $' + (Math.floor(Math.random() * 500) + 50),
            desc: 'Premium Product - Customer: ' + ['Sarah K.', 'Mike T.', 'Jenny L.', 'Alex R.'][Math.floor(Math.random() * 4)],
            platform: ['Amazon', 'Shopify', 'eBay'][Math.floor(Math.random() * 3)],
            time: 'Just now'
        }
    ];
    
    // Add new activity to feed
    const feed = document.getElementById('activityFeed');
    const newActivity = createActivityElement(activities[0]);
    feed.insertBefore(newActivity, feed.firstChild);
    
    // Remove old activities (keep max 10)
    if (feed.children.length > 10) {
        feed.removeChild(feed.lastChild);
    }
}

function createActivityElement(activity) {
    const item = document.createElement('div');
    item.className = `activity-item ${activity.type}`;
    item.innerHTML = `
        <div class="activity-icon ${activity.type}-icon">${activity.icon}</div>
        <div class="activity-content">
            <div class="activity-main">
                <h4>${activity.title}</h4>
                <p>${activity.desc}</p>
            </div>
            <div class="activity-meta">
                <span class="activity-time">${activity.time}</span>
                <span class="activity-platform">${activity.platform}</span>
            </div>
        </div>
        <button class="activity-action" onclick="viewActivityDetails()">View</button>
    `;
    
    // Add entrance animation
    item.style.opacity = '0';
    item.style.transform = 'translateX(-20px)';
    setTimeout(() => {
        item.style.transition = 'all 0.3s ease';
        item.style.opacity = '1';
        item.style.transform = 'translateX(0)';
    }, 100);
    
    return item;
}

// Action Functions
function fixInventoryIssues() {
    showPremiumToast('🔧 Analyzing inventory discrepancies...', 'info');
    setTimeout(() => {
        showPremiumToast('✅ 2 inventory issues resolved successfully!', 'success');
    }, 2000);
}

function updatePricing() {
    showPremiumToast('💰 Updating competitive pricing...', 'info');
    setTimeout(() => {
        showPremiumToast('✅ Pricing updated based on market analysis!', 'success');
    }, 3000);
}

function syncAllPlatforms() {
    runQuickSync();
}

function generateReport() {
    showPremiumToast('📊 Generating comprehensive report...', 'info');
    setTimeout(() => {
        showPremiumToast('✅ Report generated and sent to your email!', 'success');
    }, 2000);
}

function refreshDashboard() {
    const refreshBtn = document.getElementById('refreshBtn');
    refreshBtn.classList.add('spinning');
    
    showPremiumToast('🔄 Refreshing dashboard data...', 'info');
    
    setTimeout(() => {
        refreshBtn.classList.remove('spinning');
        updateRealtimeData();
        showPremiumToast('✅ Dashboard updated with latest data!', 'success');
    }, 2000);
}

// Utility Functions
function updateTimeDisplay() {
    // Update time-based content
}

function initializeFloatingShapes() {
    const shapes = document.querySelectorAll('.shape');
    shapes.forEach(shape => {
        const duration = 15 + Math.random() * 10;
        shape.style.animationDuration = duration + 's';
    });
}

function setupScrollAnimations() {
    const observer = new IntersectionObserver((entries) => {
        entries.forEach(entry => {
            if (entry.isIntersecting) {
                entry.target.classList.add('animate-in');
            }
        });
    }, {
        threshold: 0.1,
        rootMargin: '0px 0px -50px 0px'
    });

    document.querySelectorAll('.chart-card, .action-group').forEach(el => {
        observer.observe(el);
    });
}

// Cleanup on page unload
window.addEventListener('beforeunload', () => {
    if (realtimeInterval) {
        clearInterval(realtimeInterval);
    }
});
</script>
{% endblock %}