{% extends "base.html" %}

{% block content %}
<section class="page-section">
    <div class="section-header">
        <h2 class="section-title">
            <span class="title-icon">ðŸ›’</span>
            Products
        </h2>
        <p class="section-subtitle">Manage your product catalog</p>
    </div>

    <div class="card" style="padding: 1rem;">
        <div style="display:flex; gap: .5rem; flex-wrap: wrap; margin-bottom: .75rem;">
            <input id="newName" placeholder="Name" class="input" />
            <input id="newSku" placeholder="SKU" class="input" />
            <input id="newQty" placeholder="Qty" class="input" type="number" />
            <button class="btn btn-primary" onclick="createProduct()">Add</button>
        </div>
        <div id="productsList" class="data-grid">Loading...</div>
    </div>
</section>
{% endblock %}

{% block scripts %}
<script>
document.addEventListener('DOMContentLoaded', () => {
  loadProducts();
});

async function loadProducts() {
  try {
    const res = await DataAutomationBot.utils.apiRequest('/products');
    const list = document.getElementById('productsList');
    if (!res.products || res.products.length === 0) {
      list.textContent = 'No products yet';
      return;
    }
    list.innerHTML = res.products.map(p => `
      <div class="row">
        <div><strong>${p.name || ''}</strong></div>
        <div>SKU: ${p.sku || ''}</div>
        <div>Qty: ${p.quantity ?? ''}</div>
      </div>
    `).join('');
  } catch (e) {
    document.getElementById('productsList').textContent = 'Failed to load products';
  }
}

async function createProduct() {
  const name = document.getElementById('newName').value.trim();
  const sku = document.getElementById('newSku').value.trim();
  const qty = parseInt(document.getElementById('newQty').value || '0', 10);
  if (!name || !sku) {
    DataAutomationBot.utils.showToast('Name and SKU required', 'warning');
    return;
  }
  try {
    await DataAutomationBot.utils.apiRequest('/products', {
      method: 'POST',
      body: JSON.stringify({ name, sku, quantity: qty })
    });
    DataAutomationBot.utils.showToast('Product created', 'success');
    document.getElementById('newName').value = '';
    document.getElementById('newSku').value = '';
    document.getElementById('newQty').value = '';
    loadProducts();
  } catch (e) {
    DataAutomationBot.utils.showToast('Failed to create product', 'error');
  }
}
</script>
{% endblock %}